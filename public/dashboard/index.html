<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> HelioPulse Observatory - Dashboard C贸smico</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos adicionales en l铆nea */
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #ff6b35;
            background: rgba(255,107,53,0.1);
            padding: 0.5rem;
            border-radius: 5px;
            border-left: 3px solid #ff6b35;
        }
        .success {
            color: #00ff88;
            background: rgba(0,255,136,0.1);
            padding: 0.5rem;
            border-radius: 5px;
            border-left: 3px solid #00ff88;
        }
    </style>
</head>
<body>
    <!-- Header C贸smico -->
    <header class="cosmic-header">
        <h1><i class="fas fa-sun"></i> OBSERVATORIO HELIOPULSE</h1>
        <h2>Monitoreo C贸smico para la Paz Global</h2>
        <p class="chizhevsky-quote">
            <i class="fas fa-quote-left"></i>
            "La humanidad no es s贸lo un habitante de la Tierra, 
            sino tambi茅n del universo, someti茅ndose a las influencias 
            de las fuerzas c贸smicas."
            <br>
            <strong>- Alexander L. Chizhevsky</strong>
            <i class="fas fa-quote-right"></i>
        </p>
        <div class="update-time">
            <span id="current-time">Cargando...</span> | 
            Puerto: <span id="current-port">2220</span> | 
            Ciclo Solar: <span id="solar-cycle">25</span>
        </div>
    </header>

    <!-- Grid Principal del Dashboard -->
    <main class="dashboard-grid">
        <!-- Panel de Estado Solar -->
        <section class="cosmic-card">
            <h3 class="card-title">
                <i class="fas fa-sun"></i> ESTADO SOLAR
            </h3>
            
            <div class="solar-indicator">
                <div class="indicator-group">
                    <div class="indicator-value" id="solar-wind">--</div>
                    <div class="indicator-label">Viento Solar (km/s)</div>
                </div>
                <div class="indicator-group">
                    <div class="indicator-value" id="sunspots">--</div>
                    <div class="indicator-label">Manchas Solares</div>
                </div>
            </div>
            
            <div class="risk-meter">
                <div class="risk-level" id="solar-risk" style="width: 0%"></div>
            </div>
            <div class="meter-labels">
                <span>Bajo</span>
                <span>Medio</span>
                <span>Alto</span>
            </div>
            
            <div id="solar-status" class="mt-1">
                <span class="status-indicator status-warning"></span>
                <span class="loading">Cargando datos solares...</span>
            </div>
            
            <div class="info-grid mt-1">
                <div class="info-item">
                    <div class="info-label">Temperatura</div>
                    <div class="info-value" id="solar-temp">-- K</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Densidad</div>
                    <div class="info-value" id="solar-density">-- p/cm鲁</div>
                </div>
            </div>
        </section>

        <!-- ndice Chizhevsky -->
        <section class="cosmic-card">
            <h3 class="card-title">
                <i class="fas fa-brain"></i> NDICE CHIZHEVSKY
            </h3>
            
            <div class="text-center">
                <div class="indicator-value" id="chizhevsky-index" style="font-size: 3rem;">--</div>
                <div id="chizhevsky-level" class="loading">Calculando...</div>
            </div>
            
            <div class="risk-meter">
                <div class="risk-level" id="excitability-level" style="width: 0%"></div>
            </div>
            <div class="meter-labels">
                <span>Estable</span>
                <span>Vigilancia</span>
                <span>Alerta</span>
            </div>
            
            <div class="info-grid mt-1">
                <div class="info-item">
                    <div class="info-label">Impacto Social</div>
                    <div class="info-value" id="social-impact">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Potencial Creativo</div>
                    <div class="info-value" id="creative-potential">--/10</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Riesgo Conflicto</div>
                    <div class="info-value" id="conflict-risk">--/10</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Tendencia</div>
                    <div class="info-value" id="chizhevsky-trend">--</div>
                </div>
            </div>
            
            <div id="chizhevsky-interpretation" class="mt-1" style="font-style: italic; color: #aaa;">
                An谩lisis heliobiol贸gico en progreso...
            </div>
        </section>

        <!-- Campo Geomagn茅tico -->
        <section class="cosmic-card">
            <h3 class="card-title">
                <i class="fas fa-magnet"></i> CAMPO GEOMAGNTICO
            </h3>
            
            <div class="text-center">
                <div class="indicator-value" id="kp-index" style="font-size: 3rem;">--</div>
                <div id="kp-level" class="loading">Nivel KP</div>
            </div>
            
            <div id="geomagnetic-status" class="mt-1">
                <span class="status-indicator status-warning"></span>
                <span class="loading">Evaluando estado...</span>
            </div>
            
            <div class="info-grid mt-1">
                <div class="info-item">
                    <div class="info-label">Tormenta</div>
                    <div class="info-value" id="storm-warning">No activa</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ndice Dst</div>
                    <div class="info-value" id="dst-index">-- nT</div>
                </div>
            </div>
            
            <div class="mt-1">
                <h4><i class="fas fa-rainbow"></i> Aurora</h4>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Visibilidad</div>
                        <div class="info-value" id="aurora-visibility">--</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Latitud m铆nima</div>
                        <div class="info-value" id="aurora-latitude">--掳</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stream de Datos en Tiempo Real -->
        <section class="cosmic-card" style="grid-column: span 2;">
            <h3 class="card-title">
                <i class="fas fa-satellite-dish"></i> STREAM DE DATOS CSMICOS
            </h3>
            
            <div class="data-stream" id="data-log">
                <div class="data-entry">
                    <span class="data-time">[21:45:00]</span>
                    Inicializando Observatorio HelioPulse...
                </div>
                <div class="data-entry">
                    <span class="data-time">[21:45:01]</span>
                    Conectando con fuentes de datos solares...
                </div>
                <div class="data-entry">
                    <span class="data-time">[21:45:02]</span>
                    Sistema de an谩lisis Chizhevsky activado...
                </div>
            </div>
            
            <div class="info-grid mt-1">
                <div class="info-item">
                    <div class="info-label">Conexi贸n WebSocket</div>
                    <div class="info-value" id="ws-status">
                        <span class="status-indicator status-warning"></span> Conectando...
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">ltima actualizaci贸n</div>
                    <div class="info-value" id="last-update">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Intervalo</div>
                    <div class="info-value">30 segundos</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Modo</div>
                    <div class="info-value" id="data-mode">En vivo</div>
                </div>
            </div>
        </section>

        <!-- Panel de Correlaci贸n Hist贸rica -->
        <section class="cosmic-card">
            <h3 class="card-title">
                <i class="fas fa-history"></i> CORRELACIN HISTRICA
            </h3>
            
            <div class="text-center mb-1">
                <div class="indicator-value" id="correlation-score">--</div>
                <div class="indicator-label">Puntuaci贸n de Correlaci贸n</div>
            </div>
            
            <div id="historical-events">
                <div class="loading">Cargando eventos hist贸ricos...</div>
            </div>
            
            <div class="mt-1">
                <button onclick="loadHistoricalData()" class="info-item" style="width: 100%; text-align: center; cursor: pointer; background: rgba(157,78,221,0.2);">
                    <i class="fas fa-sync-alt"></i> Actualizar Datos Hist贸ricos
                </button>
            </div>
        </section>

        <!-- Panel de Control y Configuraci贸n -->
        <section class="cosmic-card">
            <h3 class="card-title">
                <i class="fas fa-sliders-h"></i> CONTROLES
            </h3>
            
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Actualizaci贸n Autom谩tica</div>
                    <div class="info-value">
                        <label class="switch">
                            <input type="checkbox" id="auto-update-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">Alertas de Sonido</div>
                    <div class="info-value">
                        <label class="switch">
                            <input type="checkbox" id="sound-alerts-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="mt-1">
                <button onclick="refreshAllData()" style="width: 100%; padding: 10px; background: linear-gradient(90deg, var(--solar-gold), var(--corona-orange)); border: none; border-radius: 8px; color: black; font-weight: bold; cursor: pointer; margin-bottom: 10px;">
                    <i class="fas fa-sync-alt"></i> ACTUALIZAR TODOS LOS DATOS
                </button>
                
                <button onclick="testEndpoints()" style="width: 100%; padding: 10px; background: rgba(76,201,240,0.2); border: 1px solid var(--star-blue); border-radius: 8px; color: white; cursor: pointer;">
                    <i class="fas fa-vial"></i> PROBAR ENDPOINTS
                </button>
            </div>
            
            <div class="update-time mt-1">
                <div id="system-status" class="success">
                    <i class="fas fa-check-circle"></i> Sistema operativo
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer style="text-align: center; padding: 2rem; color: #666; border-top: 1px solid rgba(255,215,0,0.1);">
        <p>
            <strong> Observatorio HelioPulse</strong> | 
            Honrando el legado de Alexander L. Chizhevsky
        </p>
        <p style="font-size: 0.9rem; margin-top: 0.5rem;">
            Monitoreando el pulso solar para la paz global | 
            Puerto 2220 | 
            <span id="footer-time">--:--:--</span>
        </p>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="js/heliopulse.js"></script>
    <script>
        // Estilos para switches
        const style = document.createElement('style');
        style.textContent = `
            .switch {
                position: relative;
                display: inline-block;
                width: 50px;
                height: 24px;
            }
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #333;
                transition: .4s;
                border-radius: 24px;
            }
            .slider:before {
                position: absolute;
                content: "";
                height: 16px;
                width: 16px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }
            input:checked + .slider {
                background-color: var(--aurora-green);
            }
            input:checked + .slider:before {
                transform: translateX(26px);
            }
        `;
        document.head.appendChild(style);

        // Funci贸n para actualizar tiempo en footer
        function updateFooterTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('es-ES');
            const dateStr = now.toLocaleDateString('es-ES');
            document.getElementById('footer-time').textContent = `${dateStr} ${timeStr}`;
            document.getElementById('current-time').textContent = timeStr;
        }
        
        // Actualizar tiempo cada segundo
        setInterval(updateFooterTime, 1000);
        updateFooterTime();

        // Funci贸n para refrescar todos los datos
        function refreshAllData() {
            if (window.helioPulse) {
                window.helioPulse.loadInitialData();
                document.getElementById('system-status').className = 'success';
                document.getElementById('system-status').innerHTML = 
                    '<i class="fas fa-sync-alt fa-spin"></i> Actualizando datos...';
            }
        }

        // Funci贸n para probar endpoints
        async function testEndpoints() {
            const endpoints = [
                '/api/solar/status',
                '/api/analysis/chizhevsky?kp=4.5&sunspots=85',
                '/api/historical/cycle/25'
            ];
            
            const statusEl = document.getElementById('system-status');
            statusEl.className = 'loading';
            statusEl.innerHTML = '<i class="fas fa-vial"></i> Probando endpoints...';
            
            let allOk = true;
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const data = await response.json();
                    
                    if (!data.success) {
                        allOk = false;
                        console.error(`Endpoint ${endpoint} fall贸:`, data.error);
                    }
                } catch (error) {
                    allOk = false;
                    console.error(`Error en ${endpoint}:`, error);
                }
            }
            
            if (allOk) {
                statusEl.className = 'success';
                statusEl.innerHTML = '<i class="fas fa-check-circle"></i> Todos los endpoints funcionan';
            } else {
                statusEl.className = 'error';
                statusEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Algunos endpoints fallaron';
            }
        }

        // Funci贸n para cargar datos hist贸ricos
        async function loadHistoricalData() {
            const eventsEl = document.getElementById('historical-events');
            eventsEl.innerHTML = '<div class="loading">Cargando...</div>';
            
            try {
                const response = await fetch('/api/historical/cycle/25');
                const data = await response.json();
                
                if (data.success) {
                    eventsEl.innerHTML = '';
                    data.data.events.forEach(event => {
                        const eventDiv = document.createElement('div');
                        eventDiv.className = 'data-entry';
                        eventDiv.innerHTML = `<i class="fas fa-star" style="color: var(--solar-gold);"></i> ${event}`;
                        eventsEl.appendChild(eventDiv);
                    });
                    
                    document.getElementById('correlation-score').textContent = 
                        data.data.correlation.score.toFixed(2);
                }
            } catch (error) {
                eventsEl.innerHTML = `<div class="error">Error cargando datos hist贸ricos</div>`;
            }
        }

        // Inicializar WebSocket
        const socket = io('http://localhost:2220');
        
        socket.on('connect', () => {
            document.getElementById('ws-status').innerHTML = 
                '<span class="status-indicator status-good"></span> Conectado';
            socket.emit('subscribe:solar', { region: 'global' });
        });
        
        socket.on('disconnect', () => {
            document.getElementById('ws-status').innerHTML = 
                '<span class="status-indicator status-danger"></span> Desconectado';
        });
        
        socket.on('solar:update', (data) => {
            // Actualizar datos en tiempo real
            if (window.helioPulse && window.helioPulse.data.solar) {
                window.helioPulse.data.solar.data.solarWind.speed = data.solarWind.speed;
                window.helioPulse.updateSolarPanel();
            }
            
            // Agregar al log
            const logEntry = document.createElement('div');
            logEntry.className = 'data-entry';
            logEntry.innerHTML = `
                <span class="data-time">[${new Date().toLocaleTimeString('es-ES', {hour12: false})}]</span>
                WebSocket: Solar ${data.solarWind.speed.toFixed(0)} km/s, KP ${data.kpIndex.toFixed(1)}
            `;
            document.getElementById('data-log').prepend(logEntry);
        });

        // Cargar datos iniciales
        document.addEventListener('DOMContentLoaded', () => {
            refreshAllData();
            loadHistoricalData();
            testEndpoints();
        });
    </script>
</body>
</html>
